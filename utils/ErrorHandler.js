sap.ui.define(["sap/ui/base/Object","sap/m/MessageBox"],function(e,r){"use strict";return e.extend("chris.calendar.utils.ErrorHandler",{constructor:function(e){if(this._oComponent=e,this._oModel=e.getModel(),this._bMessageOpen=!1,this._sErrorText="",this._oModel)try{this._oModel.attachMetadataFailed(function(e){var r=e.getParameters();this._extractErrorMessages(r.response),this._showMetadataError()},this),this._oModel.attachRequestFailed(function(e){var r=e.getParameters();if("0"==r.response.statusCode&&location.assign("/"),("404"!==r.response.statusCode||404===r.response.statusCode&&0===r.response.responseText.indexOf("Cannot POST"))&&(this._extractErrorMessages(r.response),this._showServiceError(),this._oModel.hasPendingChanges())){var s=this._oModel.getPendingChanges(),t=[];for(var o in s)s.hasOwnProperty(o)&&t.push("/{0}".format(o));for(var a in t&&this._oModel.resetChanges(t),this._oModel.oData)this._oModel.oData.hasOwnProperty(a)&&t.includes("/{0}".format(a))&&delete this._oModel.oData[a]}},this)}catch(e){jQuery.sap.log.error(e)}},_showMetadataError:function(){r.error(this._sErrorText,{id:"metadataErrorMessageBox",styleClass:"sapUiSizeCozy",actions:[r.Action.RETRY,r.Action.CLOSE],onClose:function(e){e===r.Action.RETRY&&(this._oModel.refreshMetadata(),this._sErrorText="")}.bind(this)})},_showServiceError:function(){this._bMessageOpen||(this._bMessageOpen=!0,r.error(this._sErrorText,{id:"serviceErrorMessageBox",styleClass:"sapUiSizeCozy",actions:[r.Action.CLOSE],onClose:function(){this._bMessageOpen=!1,this._sErrorText=""}.bind(this)}))},_extractErrorMessages:function(e){var r=[],s;try{(s=JSON.parse(e.responseText).error).innererror&&s.innererror.errordetails&&s.innererror.errordetails.length?(r=s.innererror.errordetails,1<s.innererror.errordetails.length&&r.pop(),r.forEach(function(e,r){this._sErrorText+=e.message+"\n"}.bind(this))):this._sErrorText=s.message.value}catch(e){jQuery.sap.log.error(e)}}})});